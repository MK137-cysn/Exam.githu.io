<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Registration System (Cloud Sync)</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;700&family=Moul&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ášá…á“á¶á”á‘ Ultra Premium áŠá¼á…á˜á»á“ */
        :root { --primary: #800000; --glass: rgba(255, 255, 255, 0.9); }
        body { 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%; animation: gradient 15s ease infinite;
            font-family: 'Kantumruy Pro', sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .main-card { border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 25px 50px rgba(0,0,0,0.15); max-width: 450px; width: 100%; background: var(--glass); backdrop-filter: blur(20px); padding: 40px 30px; position: relative; }
        .form-control, .form-select { border-radius: 15px; padding: 12px 18px; border: 2px solid transparent; background: #f8f9fa; transition: 0.3s; }
        .form-control:focus { border-color: var(--primary); background: #fff; transform: translateY(-2px); }
        .btn-register { background: var(--primary); color: white; border-radius: 18px; padding: 15px; font-weight: 700; width: 100%; border: none; margin-top: 15px; box-shadow: 0 10px 20px rgba(128, 0, 0, 0.2); transition: 0.3s; }
        .btn-register:hover { transform: scale(1.02); background: #a00000; }
        .chat-admin { position: fixed; bottom: 30px; left: 30px; width: 60px; height: 60px; background: #0088cc; border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 26px; text-decoration: none; box-shadow: 0 10px 20px rgba(0,136,204,0.3); z-index: 1000; }
        .admin-trigger { position: fixed; top: 20px; right: 20px; color: white; font-size: 22px; cursor: pointer; opacity: 0.5; z-index: 1000; }
        .group-area { background: #eef9ff; border-radius: 20px; padding: 20px; border: 1px dashed #0088cc; display: none; margin-top: 20px; text-align: center; }
        
        /* Modal Admin */
        .custom-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 2000; }
        .modal-content { background: white; width: 90%; max-width: 420px; margin: 50px auto; border-radius: 25px; padding: 30px; max-height: 85vh; overflow-y: auto; }
    </style>
</head>
<body>

<a href="https://t.me/Im_RA12" target="_blank" class="chat-admin"><i class="fa-brands fa-telegram"></i></a>
<div class="admin-trigger" onclick="openAdmin()"><i class="fa-solid fa-shield-halved"></i></div>

<div class="main-card">
    <div class="text-center mb-4">
        <h2 id="display_site_title" style="font-family: 'Moul'; color: #800000;">á€áŸ†á–á»á„á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™...</h2>
        <p class="text-muted small">á”áŸ’ášá–áŸá“áŸ’á’á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡á¢á“á¡á¶á‰ V2.0</p>
    </div>

    <form id="regForm">
        <div id="dynamic_inputs_area"></div>
        
        <div class="mb-3">
            <label class="form-label small fw-bold text-secondary">á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</label>
            <select id="grade_select" class="form-select" onchange="showGroupButton()" required>
                <option value="">--á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹--</option>
                <option value="9">ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ©</option>
                <option value="10">ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¡áŸ </option>
                <option value="11">ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¡áŸ¡</option>
                <option value="12">ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¡áŸ¢</option>
            </select>
        </div>

        <div id="group_area" class="group-area">
            <p class="small fw-bold mb-2">á…á¼á›ášá½á˜á€áŸ’ášá»á˜ááŸá¡áŸá€áŸ’ášá¶á˜ááŸ’á“á¶á€áŸ‹á‘á¸ <span id="grade_num"></span></p>
            <a href="#" id="group_link" target="_blank" class="btn btn-primary rounded-pill w-100 fw-bold">
                <i class="fa-brands fa-telegram me-1"></i> á…á¼á›ášá½á˜á¥á¡á¼áœá“áŸáŸ‡
            </a>
        </div>

        <button type="submit" class="btn-register" id="display_btn_text">á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡á¥á¡á¼áœá“áŸáŸ‡</button>
    </form>
</div>

<div class="custom-modal" id="admin_modal">
    <div class="modal-content">
        <h5 class="fw-bold mb-4 text-center text-danger"><i class="fa-solid fa-lock me-2"></i>Admin Dashboard</h5>
        <div id="admin_login">
            <input type="password" id="admin_pwd" class="form-control mb-3 text-center" placeholder="Password">
            <button class="btn btn-dark w-100 rounded-pill py-2" onclick="checkAdmin()">á…á¼á›á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„</button>
            <button class="btn btn-link w-100 mt-2 text-muted small" onclick="closeAdmin()">á”á·á‘</button>
        </div>
        <div id="admin_controls" style="display: none;">
            <label class="small fw-bold mb-1">á…áŸ†áá„á‡á¾á„ & á”áŸŠá¼áá»á„</label>
            <input type="text" id="input_site_title" class="form-control mb-2" placeholder="Site Title">
            <input type="text" id="input_btn_text" class="form-control mb-3" placeholder="Button Text">
            <hr>
            <label class="small fw-bold mb-1">á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á”áŸ’ášá¢á”áŸ‹á‘á·á“áŸ’á“á“áŸá™ (Inputs)</label>
            <div class="input-group mb-2">
                <input type="text" id="new_field_name" class="form-control" placeholder="á§. á›áŸáá‘á¼ášáŸá–áŸ’á‘">
                <button class="btn btn-primary" onclick="addNewField()">+</button>
            </div>
            <div id="admin_fields_list" class="mb-3"></div>
            <hr>
            <label class="small fw-bold mb-1 text-primary">Links á€áŸ’ášá»á˜ Telegram</label>
            <div class="row g-2 mb-3">
                <div class="col-6"><input type="text" id="link_9" class="form-control" placeholder="Link 9"></div>
                <div class="col-6"><input type="text" id="link_10" class="form-control" placeholder="Link 10"></div>
                <div class="col-6"><input type="text" id="link_11" class="form-control" placeholder="Link 11"></div>
                <div class="col-6"><input type="text" id="link_12" class="form-control" placeholder="Link 12"></div>
            </div>
            <button class="btn btn-danger w-100 rounded-pill fw-bold py-2" onclick="saveToCloud()">ğŸ’¾ ášá€áŸ’áŸá¶á‘á»á€á‘áŸ…á€á¶á“áŸ‹ Cloud</button>
        </div>
    </div>
</div>

<script>
    // 1. Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyD0CoOErw8unJ2lGF3K4BqTAnq0eFq3ycI",
        authDomain: "myessayapp.firebaseapp.com",
        databaseURL: "https://myessayapp-default-rtdb.firebaseio.com",
        projectId: "myessayapp",
        storageBucket: "myessayapp.firebasestorage.app",
        messagingSenderId: "410054064875",
        appId: "1:410054064875:web:7d073851f478564eb39cae"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const adminPass = "0319995568";
    let config = {};

    // 2. á”á„áŸ’á á¶á‰á‘á·á“áŸ’á“á“áŸá™á–á¸ Cloud (Sync Real-time)
    db.ref('webConfig').on('value', (snapshot) => {
        config = snapshot.val() || {
            siteTitle: "á‘á˜áŸ’ášá„áŸ‹á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡",
            btnText: "á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡á¥á¡á¼áœá“áŸáŸ‡",
            fields: [{label: "áˆáŸ’á˜áŸ„áŸ‡á–áŸá‰"}],
            links: {"9": "#", "10": "#", "11": "#", "12": "#"}
        };
        renderFormFields();
    });

    function renderFormFields() {
        document.getElementById('display_site_title').innerText = config.siteTitle;
        document.getElementById('display_btn_text').innerText = config.btnText;
        const area = document.getElementById('dynamic_inputs_area');
        area.innerHTML = '';
        config.fields.forEach(f => {
            area.innerHTML += `<div class="mb-3"><label class="form-label small fw-bold text-secondary">${f.label}</label><input type="text" class="form-control user-input" data-label="${f.label}" placeholder="á”áŸ†á–áŸá‰${f.label}..." required></div>`;
        });
    }

    // 3. Admin Functions
    function openAdmin() { document.getElementById('admin_modal').style.display='block'; }
    function closeAdmin() { document.getElementById('admin_modal').style.display='none'; }

    function checkAdmin() {
        if(document.getElementById('admin_pwd').value === adminPass) {
            document.getElementById('admin_login').style.display = 'none';
            document.getElementById('admin_controls').style.display = 'block';
            document.getElementById('input_site_title').value = config.siteTitle;
            document.getElementById('input_btn_text').value = config.btnText;
            document.getElementById('link_9').value = config.links["9"];
            document.getElementById('link_10').value = config.links["10"];
            document.getElementById('link_11').value = config.links["11"];
            document.getElementById('link_12').value = config.links["12"];
            renderAdminFieldsList();
        } else { alert('á›áŸááŸá˜áŸ’á„á¶ááŸ‹áá»áŸ!'); }
    }

    function renderAdminFieldsList() {
        const list = document.getElementById('admin_fields_list');
        list.innerHTML = '';
        config.fields.forEach((f, i) => {
            list.innerHTML += `<div class="d-flex justify-content-between align-items-center bg-light p-2 mb-1 rounded"><span>${f.label}</span><i class="fa-solid fa-trash text-danger" onclick="removeField(${i})" style="cursor:pointer"></i></div>`;
        });
    }

    function addNewField() {
        const name = document.getElementById('new_field_name').value;
        if(name) { 
            if(!config.fields) config.fields = [];
            config.fields.push({label: name}); 
            document.getElementById('new_field_name').value = ''; 
            renderAdminFieldsList(); 
        }
    }

    function removeField(i) { config.fields.splice(i, 1); renderAdminFieldsList(); }

    // 4. ášá€áŸ’áŸá¶á‘á»á€á‘áŸ…á€á¶á“áŸ‹ Cloud (Sync á‚áŸ’ášá”áŸ‹á‘á¼ášáŸá–áŸ’á‘á‘á¶áŸ†á„á¢áŸáŸ‹)
    function saveToCloud() {
        config.siteTitle = document.getElementById('input_site_title').value;
        config.btnText = document.getElementById('input_btn_text').value;
        config.links["9"] = document.getElementById('link_9').value;
        config.links["10"] = document.getElementById('link_10').value;
        config.links["11"] = document.getElementById('link_11').value;
        config.links["12"] = document.getElementById('link_12').value;

        db.ref('webConfig').set(config).then(() => {
            alert('Cloud Sync á‡áŸ„á‚á‡áŸá™! áŸá·áŸáŸ’áŸá‚áŸ’ášá”áŸ‹á‚áŸ’á“á¶á“á¹á„áƒá¾á‰á€á¶ášá•áŸ’á›á¶áŸáŸ‹á”áŸ’áá¼ášáŸ”');
            closeAdmin();
        });
    }

    function showGroupButton() {
        const g = document.getElementById('grade_select').value;
        const area = document.getElementById('group_area');
        if(g) { 
            area.style.display='block'; 
            document.getElementById('group_link').href = config.links[g]; 
            document.getElementById('grade_num').innerText = g;
        } else { area.style.display='none'; }
    }

    // 5. á”á‰áŸ’á‡á¼á“á–áŸááŸŒá˜á¶á“á‘áŸ… Telegram
    document.getElementById('regForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const b = document.getElementById('display_btn_text');
        b.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>á€áŸ†á–á»á„á”á‰áŸ’á‡á¼á“...';
        b.disabled = true;

        let m = `ğŸš€ *á€á¶ášá…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡ááŸ’á˜á¸ (Cloud)*\n`;
        document.querySelectorAll('.user-input').forEach(i => { m += `ğŸ”¹ *${i.getAttribute('data-label')}:* ${i.value}\n`; });
        m += `ğŸ“ *ááŸ’á“á¶á€áŸ‹á‘á¸:* ${document.getElementById('grade_select').value}`;

        fetch(`https://api.telegram.org/bot8309556629:AAFKx225sEwO-e1m8J-5Av2z9QwDLqLbL0c/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: "5010333081", text: m, parse_mode: 'Markdown' })
        }).then(() => { 
            alert('á€á¶ášá…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡á‘á‘á½á›á”á¶á“á‡áŸ„á‚á‡áŸá™!'); 
            location.reload(); 
        });
    });
</script>
</body>
</html>
